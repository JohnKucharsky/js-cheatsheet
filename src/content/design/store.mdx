
## store

```js
class Store {
  constructor() {
    this.users = [];
    this.products = [];
    this.orders = [];
    this.shelves = [];
  }

  // User API
  createUser(data) {
    if (!data.name || !data.email)
      throw new Error("User data must include name and email");
    const newUser = { id: Date.now().toString(), ...data };
    this.users.push(newUser);
    return newUser;
  }

  findUserById(id) {
    return this.users.find((user) => user.id === id) || null;
  }

  updateUser(id, data) {
    const user = this.findUserById(id);
    if (!user) throw new Error("User not found");
    Object.assign(user, data);
  }

  deleteUser(id) {
    this.users = this.users.filter((user) => user.id !== id);
  }

  listUsers() {
    return this.users;
  }

  // Product API
  createProduct(data) {
    if (!data.name || !data.price)
      throw new Error("Product data must include name and price");
    const newProduct = { id: Date.now().toString(), ...data };
    this.products.push(newProduct);
    return newProduct;
  }

  findProductById(id) {
    return this.products.find((product) => product.id === id) || null;
  }

  updateProduct(id, data) {
    const product = this.findProductById(id);
    if (!product) throw new Error("Product not found");
    Object.assign(product, data);
  }

  deleteProduct(id) {
    this.products = this.products.filter((product) => product.id !== id);
  }

  listProducts() {
    return this.products;
  }

  // Shelf API
  createShelf(name) {
    if (!name) throw new Error("Shelf name is required");
    const shelf = { id: Date.now().toString(), name, products: [] };
    this.shelves.push(shelf);
    return shelf;
  }

  findShelfById(id) {
    return this.shelves.find((shelf) => shelf.id === id) || null;
  }

  addProductToShelf(shelfId, productId, quantity) {
    if (quantity <= 0) throw new Error("Quantity must be positive");
    const shelf = this.findShelfById(shelfId);
    const product = this.findProductById(productId);

    if (!shelf) throw new Error("Shelf not found");
    if (!product) throw new Error("Product not found");

    const shelfProduct = shelf.products.find((p) => p.productId === productId);
    if (shelfProduct) {
      shelfProduct.quantity += quantity;
    } else {
      shelf.products.push({ productId, quantity });
    }
    return shelf;
  }

  removeProductFromShelf(shelfId, productId, quantity) {
    const shelf = this.findShelfById(shelfId);
    if (!shelf) throw new Error("Shelf not found");

    const shelfProduct = shelf.products.find((p) => p.productId === productId);
    if (!shelfProduct) throw new Error("Product not found on this shelf");

    if (shelfProduct.quantity < quantity)
      throw new Error("Not enough quantity to remove");

    shelfProduct.quantity -= quantity;
    if (shelfProduct.quantity === 0) {
      shelf.products = shelf.products.filter((p) => p.productId !== productId);
    }
  }

  listShelfProducts(shelfId) {
    const shelf = this.findShelfById(shelfId);
    if (!shelf) throw new Error("Shelf not found");

    return shelf.products.map((p) => ({
      product: this.findProductById(p.productId),
      quantity: p.quantity,
    }));
  }

  listAllShelves() {
    return this.shelves;
  }

  // Order API
  createOrder(userId, products, payment) {
    const user = this.findUserById(userId);
    if (!user) throw new Error("User not found");

    const validProducts = products.every((p) =>
      this.findProductById(p.productId),
    );
    if (!validProducts) throw new Error("One or more products not found");

    const order = {
      id: Date.now().toString(),
      userId,
      products,
      payment,
      createdAt: new Date(),
    };
    this.orders.push(order);
    return order;
  }

  findOrderById(id) {
    return this.orders.find((order) => order.id === id) || null;
  }

  updateOrder(id, data) {
    const order = this.findOrderById(id);
    if (!order) throw new Error("Order not found");
    Object.assign(order, data);
  }

  deleteOrder(id) {
    this.orders = this.orders.filter((order) => order.id !== id);
  }

  listOrders() {
    return this.orders;
  }

  getUserOrders(userId) {
    return this.orders.filter((order) => order.userId === userId);
  }

  getProductOnShelves(productId) {
    return this.shelves
      .filter((shelf) => shelf.products.some((p) => p.productId === productId))
      .map((shelf) => ({
        shelfName: shelf.name,
        quantity: shelf.products.find((p) => p.productId === productId)
          .quantity,
      }));
  }
}

// Usage example
const store = new Store();

// Create a user
const user = store.createUser({ name: "John Doe", email: "john@example.com" });

// Create a product
const product = store.createProduct({ name: "Laptop", price: 1200 });

// Create a shelf and add product to it
const shelf = store.createShelf("Electronics");
store.addProductToShelf(shelf.id, product.id, 10);

// List products on the shelf
console.log(store.listShelfProducts(shelf.id));

// Create an order for the user
const order = store.createOrder(
  user.id,
  [{ productId: product.id, quantity: 2 }],
  "credit_card",
);
console.log(order);

// Get orders for a user
console.log(store.getUserOrders(user.id));

// Check shelves for a product
console.log(store.getProductOnShelves(product.id));

// Remove product from shelf
store.removeProductFromShelf(shelf.id, product.id, 5);
console.log(store.listShelfProducts(shelf.id));

// List all users, products, orders, and shelves
console.log(store.listUsers());
console.log(store.listProducts());
console.log(store.listOrders());
console.log(store.listAllShelves());
```